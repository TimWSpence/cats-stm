<!DOCTYPE html><html><head><title>Cats STM: Tutorial</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Tim Spence" /><meta name="description" content="Software Transactional Memory for Cats Effect" /><meta name="og:image" content="/cats-stm/img/poster.png" /><meta name="image" property="og:image" content="/cats-stm/img/poster.png" /><meta name="og:title" content="Cats STM: Tutorial" /><meta name="title" property="og:title" content="Cats STM: Tutorial" /><meta name="og:site_name" content="Cats STM" /><meta name="og:url" content="https://github.com/TimWSpence/cats-stm" /><meta name="og:type" content="website" /><meta name="og:description" content="Software Transactional Memory for Cats Effect" /><link rel="icon" type="image/png" href="/cats-stm/img/favicon.png" /><meta name="twitter:title" content="Cats STM: Tutorial" /><meta name="twitter:image" content="/cats-stm/img/poster.png" /><meta name="twitter:description" content="Software Transactional Memory for Cats Effect" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/cats-stm/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/cats-stm/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/cats-stm/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/cats-stm/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/cats-stm/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/cats-stm/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/cats-stm/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/cats-stm/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/cats-stm/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/cats-stm/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/cats-stm/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/cats-stm/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/cats-stm/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/cats-stm/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/cats-stm/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/cats-stm/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/cats-stm/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/cats-stm/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/cats-stm/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/cats-stm/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/cats-stm/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/cats-stm/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/cats-stm/" class="brand"><div class="brand-wrapper"></div><span>Cats STM</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/cats-stm/datatypes" title="Data Types" class="drop-nested">Data Types</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/cats-stm/datatypes/index.html" title="Theory" class="">Theory</a> <a href="/cats-stm/datatypes/stm.html" title="STM" class="">STM</a> <a href="/cats-stm/datatypes/tvar.html" title="TVar" class="">TVar</a> <a href="/cats-stm/datatypes/tmvar.html" title="TMVar" class="">TMVar</a> <a href="/cats-stm/datatypes/tqueue.html" title="TQueue" class="">TQueue</a> <a href="/cats-stm/datatypes/tsemaphore.html" title="TSemaphore" class="">TSemaphore</a></div></div> <div class="sidebar-nav-item active "><a href="/cats-stm/tutorial/tutorial.html" title="Tutorial" class="active">Tutorial</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/TimWSpence/cats-stm" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/TimWSpence/cats-stm" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="TimWSpence" data-github-repo="cats-stm"><div class="content-wrapper"><section><nav role="navigation" id="toc"></nav>

<h2 id="the-santa-claus-problem">The Santa Claus Problem</h2>

<blockquote>
  <p>Santa repeatedly sleeps until wakened by either all of his nine rein-deer, back from their holidays, or by a group of three of his ten elves. If awakened by the reindeer, he harnesses each of them to his sleigh, delivers toys with them and finally unharnesses them (allowing them to go off on holiday). If awakened by a group of elves, he shows each of the group into his study, consults with them on toy R&amp;D and finally shows them each out (allowing them to go back to work). Santa should give priority to the reindeer in the case that there is both a group of elves and a group of reindeer waiting.</p>
</blockquote>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.github.timwspence.cats.stm._</span>
<span class="k">import</span> <span class="nn">cats.data._</span>
<span class="k">import</span> <span class="nn">cats.effect._</span>
<span class="k">import</span> <span class="nn">cats.effect.unsafe.implicits.global</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>

<span class="k">val</span> <span class="nv">stm</span> <span class="k">=</span> <span class="nc">STM</span><span class="o">[</span><span class="kt">IO</span><span class="o">].</span><span class="py">unsafeRunSync</span><span class="o">()</span>
<span class="c1">// stm: STM[IO] = io.github.timwspence.cats.stm.STM$$anon$1@7809508c</span>
<span class="k">import</span> <span class="nn">stm._</span>

<span class="k">def</span> <span class="nf">meetInStudy</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nf">println</span><span class="o">(</span><span class="n">show</span><span class="s">"Elf $id meeting in the study"</span><span class="o">))</span>

<span class="k">def</span> <span class="nf">deliverToys</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nf">println</span><span class="o">(</span><span class="n">show</span><span class="s">"Reindeer $id delivering toys"</span><span class="o">))</span>

<span class="k">sealed</span> <span class="k">abstract</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Gate</span><span class="o">(</span><span class="n">capacity</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">tv</span><span class="k">:</span> <span class="kt">TVar</span><span class="o">[</span><span class="kt">Int</span><span class="o">]){</span>
  <span class="k">def</span> <span class="nf">pass</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Gate</span><span class="o">.</span><span class="py">pass</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">operate</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Gate</span><span class="o">.</span><span class="py">operate</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">object</span> <span class="nc">Gate</span><span class="o">{</span>
  <span class="k">def</span> <span class="nf">of</span><span class="o">(</span><span class="n">capacity</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span>
    <span class="nv">TVar</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="k">new</span> <span class="nc">Gate</span><span class="o">(</span><span class="n">capacity</span><span class="o">,</span> <span class="k">_</span><span class="o">){})</span>

  <span class="k">def</span> <span class="nf">pass</span><span class="o">(</span><span class="n">g</span><span class="k">:</span> <span class="kt">Gate</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
    <span class="nv">stm</span><span class="o">.</span><span class="py">commit</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">{</span>
        <span class="n">nLeft</span> <span class="k">&lt;-</span> <span class="nv">g</span><span class="o">.</span><span class="py">tv</span><span class="o">.</span><span class="py">get</span>
        <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">stm</span><span class="o">.</span><span class="py">check</span><span class="o">(</span><span class="n">nLeft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
        <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">g</span><span class="o">.</span><span class="py">tv</span><span class="o">.</span><span class="py">modify</span><span class="o">(</span><span class="k">_</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
      <span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>
    <span class="o">}</span>

  <span class="k">def</span> <span class="nf">operate</span><span class="o">(</span><span class="n">g</span><span class="k">:</span> <span class="kt">Gate</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">for</span> <span class="o">{</span>
      <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">stm</span><span class="o">.</span><span class="py">commit</span><span class="o">(</span><span class="nv">g</span><span class="o">.</span><span class="py">tv</span><span class="o">.</span><span class="py">set</span><span class="o">(</span><span class="nv">g</span><span class="o">.</span><span class="py">capacity</span><span class="o">))</span>
      <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">stm</span><span class="o">.</span><span class="py">commit</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">{</span>
          <span class="n">nLeft</span> <span class="k">&lt;-</span> <span class="nv">g</span><span class="o">.</span><span class="py">tv</span><span class="o">.</span><span class="py">get</span>
          <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">stm</span><span class="o">.</span><span class="py">check</span><span class="o">(</span><span class="n">nLeft</span> <span class="o">===</span> <span class="mi">0</span><span class="o">)</span>
        <span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>
<span class="o">}</span>

<span class="k">sealed</span> <span class="k">abstract</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Group</span><span class="o">(</span>
  <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
  <span class="n">tv</span><span class="k">:</span> <span class="kt">TVar</span><span class="o">[(</span><span class="kt">Int</span>, <span class="kt">Gate</span>, <span class="kt">Gate</span><span class="o">)]</span>
<span class="o">){</span>
  <span class="k">def</span> <span class="nf">join</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[(</span><span class="kt">Gate</span>, <span class="kt">Gate</span><span class="o">)]</span> <span class="k">=</span> <span class="nv">Group</span><span class="o">.</span><span class="py">join</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">await</span><span class="k">:</span> <span class="kt">Txn</span><span class="o">[(</span><span class="kt">Gate</span>, <span class="kt">Gate</span><span class="o">)]</span> <span class="k">=</span> <span class="nv">Group</span><span class="o">.</span><span class="py">await</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">object</span> <span class="nc">Group</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">of</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Group</span><span class="o">]</span> <span class="k">=</span> <span class="nv">stm</span><span class="o">.</span><span class="py">commit</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">{</span>
      <span class="n">g1</span> <span class="k">&lt;-</span> <span class="nv">Gate</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
      <span class="n">g2</span> <span class="k">&lt;-</span> <span class="nv">Gate</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
      <span class="n">tv</span> <span class="k">&lt;-</span> <span class="nv">TVar</span><span class="o">.</span><span class="py">of</span><span class="o">((</span><span class="n">n</span><span class="o">,</span> <span class="n">g1</span><span class="o">,</span> <span class="n">g2</span><span class="o">))</span>
    <span class="o">}</span> <span class="k">yield</span> <span class="k">new</span> <span class="nc">Group</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">tv</span><span class="o">){}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="nf">join</span><span class="o">(</span><span class="n">g</span><span class="k">:</span> <span class="kt">Group</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[(</span><span class="kt">Gate</span>, <span class="kt">Gate</span><span class="o">)]</span> <span class="k">=</span> <span class="nv">stm</span><span class="o">.</span><span class="py">commit</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">{</span>
      <span class="o">(</span><span class="n">nLeft</span><span class="o">,</span> <span class="n">g1</span><span class="o">,</span> <span class="n">g2</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="nv">g</span><span class="o">.</span><span class="py">tv</span><span class="o">.</span><span class="py">get</span>
      <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">stm</span><span class="o">.</span><span class="py">check</span><span class="o">(</span><span class="n">nLeft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">g</span><span class="o">.</span><span class="py">tv</span><span class="o">.</span><span class="py">set</span><span class="o">((</span><span class="n">nLeft</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">g1</span><span class="o">,</span> <span class="n">g2</span><span class="o">))</span>
    <span class="o">}</span> <span class="nf">yield</span> <span class="o">(</span><span class="n">g1</span><span class="o">,</span> <span class="n">g2</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="k">def</span> <span class="nf">await</span><span class="o">(</span><span class="n">g</span><span class="k">:</span> <span class="kt">Group</span><span class="o">)</span><span class="k">:</span> <span class="kt">Txn</span><span class="o">[(</span><span class="kt">Gate</span>, <span class="kt">Gate</span><span class="o">)]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="o">(</span><span class="n">nLeft</span><span class="o">,</span> <span class="n">g1</span><span class="o">,</span> <span class="n">g2</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="nv">g</span><span class="o">.</span><span class="py">tv</span><span class="o">.</span><span class="py">get</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">stm</span><span class="o">.</span><span class="py">check</span><span class="o">(</span><span class="n">nLeft</span> <span class="o">===</span> <span class="mi">0</span><span class="o">)</span>
    <span class="n">newG1</span> <span class="k">&lt;-</span> <span class="nv">Gate</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="nv">g</span><span class="o">.</span><span class="py">n</span><span class="o">)</span>
    <span class="n">newG2</span> <span class="k">&lt;-</span> <span class="nv">Gate</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="nv">g</span><span class="o">.</span><span class="py">n</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">g</span><span class="o">.</span><span class="py">tv</span><span class="o">.</span><span class="py">set</span><span class="o">((</span><span class="nv">g</span><span class="o">.</span><span class="py">n</span><span class="o">,</span> <span class="n">newG1</span><span class="o">,</span> <span class="n">newG2</span><span class="o">))</span>
  <span class="o">}</span> <span class="nf">yield</span> <span class="o">(</span><span class="n">g1</span><span class="o">,</span> <span class="n">g2</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">def</span> <span class="nf">helper1</span><span class="o">(</span><span class="n">group</span><span class="k">:</span> <span class="kt">Group</span><span class="o">,</span> <span class="n">doTask</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">])</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="o">(</span><span class="n">inGate</span><span class="o">,</span> <span class="n">outGate</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="nv">group</span><span class="o">.</span><span class="py">join</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">inGate</span><span class="o">.</span><span class="py">pass</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">doTask</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">outGate</span><span class="o">.</span><span class="py">pass</span>
<span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>

<span class="k">def</span> <span class="nf">elf2</span><span class="o">(</span><span class="n">group</span><span class="k">:</span> <span class="kt">Group</span><span class="o">,</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
  <span class="nf">helper1</span><span class="o">(</span><span class="n">group</span><span class="o">,</span> <span class="nf">meetInStudy</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>


<span class="k">def</span> <span class="nf">reindeer2</span><span class="o">(</span><span class="n">group</span><span class="k">:</span> <span class="kt">Group</span><span class="o">,</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
  <span class="nf">helper1</span><span class="o">(</span><span class="n">group</span><span class="o">,</span> <span class="nf">deliverToys</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>


<span class="k">def</span> <span class="nf">randomDelay</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="nc">IO</span><span class="o">(</span><span class="nv">scala</span><span class="o">.</span><span class="py">util</span><span class="o">.</span><span class="py">Random</span><span class="o">.</span><span class="py">nextInt</span><span class="o">(</span><span class="mi">10000</span><span class="o">))</span>
    <span class="o">.</span><span class="py">flatMap</span><span class="o">{</span><span class="n">n</span> <span class="k">=&gt;</span> <span class="nv">IO</span><span class="o">.</span><span class="py">sleep</span><span class="o">(</span><span class="nv">n</span><span class="o">.</span><span class="py">micros</span><span class="o">)}</span>
<span class="o">}</span>

<span class="k">def</span> <span class="nf">elf</span><span class="o">(</span><span class="n">g</span><span class="k">:</span> <span class="kt">Group</span><span class="o">,</span> <span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">FiberIO</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="o">(</span><span class="nf">elf2</span><span class="o">(</span><span class="n">g</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">&gt;&gt;</span> <span class="n">randomDelay</span><span class="o">).</span><span class="py">foreverM</span><span class="o">.</span><span class="py">start</span>
<span class="o">}</span>

<span class="k">def</span> <span class="nf">reindeer</span><span class="o">(</span><span class="n">g</span><span class="k">:</span> <span class="kt">Group</span><span class="o">,</span> <span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">FiberIO</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="o">(</span><span class="nf">reindeer2</span><span class="o">(</span><span class="n">g</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">&gt;&gt;</span> <span class="n">randomDelay</span><span class="o">).</span><span class="py">foreverM</span><span class="o">.</span><span class="py">start</span>
<span class="o">}</span>

<span class="k">def</span> <span class="nf">choose</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">choices</span><span class="k">:</span> <span class="kt">NonEmptyList</span><span class="o">[(</span><span class="kt">Txn</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>, <span class="kt">A</span> <span class="k">=&gt;</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">])])</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">actions</span> <span class="k">:</span> <span class="kt">NonEmptyList</span><span class="o">[</span><span class="kt">Txn</span><span class="o">[</span><span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]]]</span> <span class="k">=</span>  <span class="nv">choices</span><span class="o">.</span><span class="py">map</span><span class="o">{</span>
    <span class="nf">case</span> <span class="o">(</span><span class="n">guard</span><span class="o">,</span> <span class="n">rhs</span><span class="o">)</span> <span class="k">=&gt;</span>  <span class="k">for</span> <span class="o">{</span>
      <span class="n">value</span> <span class="k">&lt;-</span> <span class="n">guard</span>
    <span class="o">}</span> <span class="k">yield</span> <span class="nf">rhs</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="n">act</span> <span class="k">&lt;-</span> <span class="nv">stm</span><span class="o">.</span><span class="py">commit</span><span class="o">{</span><span class="nv">actions</span><span class="o">.</span><span class="py">reduceLeft</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">orElse</span><span class="o">(</span><span class="k">_</span><span class="o">))}</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">act</span>
  <span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>
<span class="o">}</span>

<span class="k">def</span> <span class="nf">santa</span><span class="o">(</span><span class="n">elfGroup</span><span class="k">:</span> <span class="kt">Group</span><span class="o">,</span> <span class="n">reinGroup</span><span class="k">:</span> <span class="kt">Group</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">run</span><span class="o">(</span><span class="n">task</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">gates</span><span class="k">:</span> <span class="o">(</span><span class="kt">Gate</span><span class="o">,</span> <span class="kt">Gate</span><span class="o">))</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">IO</span><span class="o">(</span><span class="nf">println</span><span class="o">(</span><span class="n">show</span><span class="s">"Ho! Ho! Ho! let’s $task"</span><span class="o">))</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">gates</span><span class="o">.</span><span class="py">_1</span><span class="o">.</span><span class="py">operate</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">gates</span><span class="o">.</span><span class="py">_2</span><span class="o">.</span><span class="py">operate</span>
  <span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>

  <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">IO</span><span class="o">(</span><span class="nf">println</span><span class="o">(</span><span class="s">"----------"</span><span class="o">))</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">choose</span><span class="o">[(</span><span class="kt">Gate</span>, <span class="kt">Gate</span><span class="o">)](</span><span class="nv">NonEmptyList</span><span class="o">.</span><span class="py">of</span><span class="o">(</span>
      <span class="o">(</span><span class="nv">reinGroup</span><span class="o">.</span><span class="py">await</span><span class="o">,</span> <span class="o">{</span> <span class="n">g</span><span class="k">:</span> <span class="o">(</span><span class="kt">Gate</span><span class="o">,</span> <span class="kt">Gate</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">run</span><span class="o">(</span><span class="s">"deliver toys"</span><span class="o">,</span> <span class="n">g</span><span class="o">)}),</span>
      <span class="o">(</span><span class="nv">elfGroup</span><span class="o">.</span><span class="py">await</span><span class="o">,</span> <span class="o">{</span> <span class="n">g</span><span class="k">:</span> <span class="o">(</span><span class="kt">Gate</span><span class="o">,</span> <span class="kt">Gate</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">run</span><span class="o">(</span><span class="s">"meet in study"</span><span class="o">,</span> <span class="n">g</span><span class="o">)})</span>
    <span class="o">))</span>
  <span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>
<span class="o">}</span>


<span class="k">def</span> <span class="nf">main</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="n">elfGroup</span> <span class="k">&lt;-</span> <span class="nv">Group</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">9</span><span class="o">,</span><span class="mi">10</span><span class="o">).</span><span class="py">traverse_</span><span class="o">(</span><span class="n">n</span> <span class="k">=&gt;</span> <span class="nf">elf</span><span class="o">(</span><span class="n">elfGroup</span><span class="o">,</span><span class="n">n</span><span class="o">))</span>
  <span class="n">reinGroup</span> <span class="k">&lt;-</span> <span class="nv">Group</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="mi">9</span><span class="o">)</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">9</span><span class="o">).</span><span class="py">traverse_</span><span class="o">(</span><span class="n">n</span> <span class="k">=&gt;</span> <span class="nf">reindeer</span><span class="o">(</span><span class="n">reinGroup</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nf">santa</span><span class="o">(</span><span class="n">elfGroup</span><span class="o">,</span> <span class="n">reinGroup</span><span class="o">).</span><span class="py">foreverM</span><span class="o">.</span><span class="py">void</span>
<span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>

<span class="nv">main</span><span class="o">.</span><span class="py">timeout</span><span class="o">(</span><span class="mf">2.</span><span class="n">seconds</span><span class="o">).</span><span class="py">attempt</span><span class="o">.</span><span class="py">unsafeRunSync</span><span class="o">()</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// Elf 9 meeting in the study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// Elf 5 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// Elf 5 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// Elf 9 meeting in the study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 5 meeting in the study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// Elf 5 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 9 meeting in the study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// Elf 5 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// Elf 9 meeting in the study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// Elf 9 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// Elf 5 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// Elf 9 meeting in the study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 5 meeting in the study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// Elf 9 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// Elf 3 meeting in the study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 9 meeting in the study</span>
<span class="c1">// Elf 7 meeting in the study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 4 meeting in the study</span>
<span class="c1">// Elf 8 meeting in the study</span>
<span class="c1">// Elf 6 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 7 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// Reindeer 9 delivering toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 8 delivering toys</span>
<span class="c1">// Reindeer 4 delivering toys</span>
<span class="c1">// Reindeer 6 delivering toys</span>
<span class="c1">// Reindeer 3 delivering toys</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s meet in study</span>
<span class="c1">// Elf 2 meeting in the study</span>
<span class="c1">// Elf 10 meeting in the study</span>
<span class="c1">// Elf 1 meeting in the study</span>
<span class="c1">// ----------</span>
<span class="c1">// Ho! Ho! Ho! let’s deliver toys</span>
<span class="c1">// Reindeer 1 delivering toys</span>
<span class="c1">// Reindeer 2 delivering toys</span>
<span class="c1">// Reindeer 5 delivering toys</span>
<span class="c1">// res0: Either[Throwable, Unit] = Left(</span>
<span class="c1">//   java.util.concurrent.TimeoutException: 2 seconds</span>
<span class="c1">// )</span>
</code></pre></div></div>
</section></div></div></div></div><script src="/cats-stm/highlight/highlight.pack.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'cats-stm/community'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/cats-stm/js/docs.js"></script></body></html>